---
title: "B450Pro4とM.2 NVMeとSATAの組み合わせ問題を解く(2023年7月時点)"
emoji: "🪔"
type: "tech"
topics: ["Debian", "Linux"]
published: false
---

本記事はそろそろストレージを交換してみようと思い立ち、調べてみたところ
意外にはまりどころが多かったというお話を書き記したものです。

結論としては、お金で解決できるなら、もっといいスペックのマシンを最初から手配しておけ、という身も蓋もないものになりました。
ただし、手持ちの機材をうまく組み合わせて活用しようというのを否定する意図はありません。

# B450Pro4にした経緯

いわゆるチップセットまで指定で、どのマザーボードになるかは店舗におまかせスタイルのBTOで購入したためです。

どれくらいまでメモリが積めるか、とかUSB Type-Cも一つあるし(今となっては見劣りするが)くらいは気にしたが、
特にどのマザーボードでないとだめというような思い入れはなかった。

たいていの場合、ある程度経過したら一式まるごと買い替えるほうが面倒がなくてよいとすら思っていたためです。

# ストレージを交換したい欲求が高まる

購入当初から使用していたのが、Intel 660pというNVMeです。
SSDに比べて高速ではあるものの、512GBだったので容量もそれほど多くなく、書き込み速度も2000MB/sに届かず今となってはやや見劣りします。
不足する容量については旧PCで使用していたSSDやHDDをSATA接続してまかなっているが、SATA接続ではインターフェースの速度の縛りもあって、遅さが気になってきました。

そこで、B450Pro4ではM.2スロットが2つあることを思い出し、新しくM.2 NVMeを調達し、現在使っているIntel 660pをサブにまわすことにしました。

## NVMeの情報を探してみたら不穏な話題を見つけた

どのNVMeを調達するか調べていたところ、つぎのような不穏な情報を入手しました。

[ASRockの特定MBとSSDの組み合わせ問題](https://pcnomori.blog.fc2.com/blog-entry-578.html)

なんとB450Pro4では認識しないものが多数あるというのです。

WDやKIOXIAのものがだめということになると、入手性のよいメジャーと思われるものは使えないということになります。

実際、ASRockのサイトでも非互換情報が公開されていました。

[Not Compatible Storage Device](https://www.asrock.com/support/qa/Not%20Compatible%20Storage%20Device.pdf)

Toshiba,Kioxia,WD,ZhiTai,ADATA,Patriot,SK Hynix,Kingston,Samsung,Lexarと聞いたことあるメーカーが名を連ねています。

Crucialは互換性のある内蔵型SSDの情報があるので、余計なトラブルを踏みたくないなら、Crucial一択でしょう。

https://www.crucial.jp/compatible-upgade-for/asrock/b450-pro4

ただし、ベンチマークの情報によると評価はいまいちなのが残念なところです。

[Crucial P5 Plusレビュー：Micronによる自社製造モデルですが･･･](https://chimolog.co/bto-ssd-crucial-p5-plus/)

# MB自体の制約を整理する

それだけでなく、よくよくB450Pro4の仕様を確認してみると、結構はまりそうな制約がいくつかあることがわかりました。

> **M2_1 デバイスで使用されている場合は、PCIE4 は無効になります。

現状ですでに制約がかかっている状態でした。
PCIE4というのは、マザーボードの4つめのPCIEスロットを指します。
GPUはPCIE2スロットを使っているので影響はないが、PCIE x4なスロットはこの時点で使えなくなっているのでした。

> *M2_2、SATA3_3、および、SATA3_4 共用レーン。 いずれかが使用されている場合は、その他は無効になります。

現在M2_1に刺しているNVMeをM2_2に移動しようと考えていたので、念の為旧PCから移設したSSDやHDDの接続先を確認してみたところ、まさにSATA3_3およびSATA3_4を利用していました。
SATA3_A1、SATA3_A2、あるいはSATA3_2等を利用する必要があるようでした。

> - 1 x M.2 ソケット (M2_2), M Key タイプ 2230/2242/2260/2280/22110 M.2 SATA3 6.0 Gb/s モジュール、および、最大 Gen3 x2 (16 Gb/s) までの M.2 PCIe モジュールに対応**

また、M2_2はせいぜい2000MB/s程度しかだせません。
ただし、Intel 660pはこの上限に達しないので影響はありませんでした。

> - 1 x ウルトラ M.2 ソケット (M2_1), 最大 Gen3 x4 (32 Gb/s) までのタイプ M Key 2242/2260/2280 M.2 PCIe モジュールに対応

M2_1は4000MB/sが上限でした。

したがって、上記制約を考慮すると次のようなことになります。

* M2_1: 新規NVMe 4000MB/sまでのもの。ただし認識しないメーカーを避けること。
* M2_2: 旧NVMeをM2_1から移設する。2000MB/sまでのもの。
* PCIE4: 使用不可
* SATA3_3: 使用不可
* SATA3_4: 使用不可

別案としては、変換ボードを介する方法もあるようです。

* M2_1: 使わない
* M2_2: 旧NVMeをM2_1から移設する。2000MB/sまでのもの。
* PCIE4: NVMe・PCIE変換ボードを介して新規NVMeを刺す。4000MB/sまでのもの。
* SATA3_3: 使用不可
* SATA3_4: 使用不可

あるいは、PCIE x1なところに変換ボードを使ってNVMeを刺すということもできるらしいです。
SATA接続のSSDよりかはましな速度が稼げなさそうです。

# さいごに

HIKSEMI 2TB NVMe (FUTURE70-02TB)は使えるという情報があったので、試してみたところ確かに使えました。
kdiskmarkで測定したところ、3200〜3500MB/s程度でるようです。(Gen4向けのをGen3なB450Pro4に刺すのはちょっともったいない気もしますが)
